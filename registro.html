<!-- registro.html -->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title data-i18n="register_title">Registro - LEXA Studios</title>

  <!-- Bootstrap CSS & JS -->
  <link 
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" 
    rel="stylesheet">
  <script 
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js">
  </script>

  <!-- CSS -->
  <link rel="stylesheet" href="css/header.css">
  <link rel="stylesheet" href="css/inicioSesion.css">

  <link rel="icon" type="image/png" sizes="64x64" href="img/logo-icon.png">
</head>
<body>
  <!-- Navbar din√°mico -->
  <div id="navbar-container"></div>
  <script src="js/navbar.js"></script>
  <script src="js/language.js"></script>

  <div class="main-container">
    <div class="login-container">
      <h2 data-i18n="register_title">Register</h2>
      <form id="form-register" method="POST" action="/api/register">
        <!-- input oculto para forzar siempre role = 2 (Usuario) -->
        <input type="hidden" name="role" value="2">

        <label for="username" data-i18n="register_user">User</label>
        <input 
          type="text" 
          id="username" 
          name="username" 
          required 
          placeholder=" "
        >

        <label for="email" data-i18n="register_email">Email</label>
        <input 
          type="email" 
          id="email" 
          name="email" 
          required 
          placeholder=" "
        >

        <label for="password" data-i18n="register_password">Password</label>
        <!-- Campo de contrase√±a normal -->
        <input 
          type="password" 
          id="password" 
          name="password" 
          required 
          autocomplete="new-password"
          placeholder=" "
        >

        <!-- Requisitos de contrase√±a -->
<ul id="password-requirements" class="list-unstyled mt-2">
  <li data-i18n="pw_min_length" class="text-white">‚ùå M√≠nimo 8 caracteres</li>
  <li data-i18n="pw_uppercase" class="text-white">‚ùå Al menos una may√∫scula</li>
  <li data-i18n="pw_lowercase" class="text-white">‚ùå Al menos una min√∫scula</li>
  <li data-i18n="pw_digit" class="text-white">‚ùå Al menos un n√∫mero</li>
  <li data-i18n="pw_special" class="text-white">‚ùå Al menos un car√°cter especial</li>
</ul>


        <!-- Bot√≥n para mostrar contrase√±a -->
        <div class="password-toggle-container">
          <button 
            type="button" 
            class="toggle-password-btn" 
            aria-label="Mostrar contrase√±a"
            id="toggle-password-btn"
          >
            üëÅÔ∏è
          </button>
        </div>

        <!-- Barra de fuerza de contrase√±a -->
        <div id="password-strength-wrapper">
          <div id="password-strength-bar">
            <div id="password-strength-fill"></div>
          </div>
          <div id="password-strength-text"></div>
        </div>

        <button 
          type="submit" 
          class="registroBoton" 
          data-i18n="register_submit" 
          style="width: 100%; margin-top: 1rem;"
        >
          Register
        </button>
        <p class="registrate">
          <span data-i18n="register_have_account">Already have an account?</span>
          <a href="inicioSesion.html" class="click-registrar" data-i18n="login_sign_in">Sign In</a>
        </p>
      </form>
    </div>
  </div>

<script>
  const passwordInput = document.getElementById('password');
  const toggleBtn     = document.getElementById('toggle-password-btn');
  const strengthFill  = document.getElementById('password-strength-fill');
  const strengthText  = document.getElementById('password-strength-text');
  const reqList       = document.getElementById('password-requirements');
  
  const pwReqs = {
    pw_min_length: val => val.length >= 8,
    pw_uppercase:  val => /[A-Z]/.test(val),
    pw_lowercase:  val => /[a-z]/.test(val),
    pw_digit:      val => /\d/.test(val),
    pw_special:    val => /[\W_]/.test(val)
  };

  // Mostrar / ocultar contrase√±a
  toggleBtn.addEventListener('click', () => {
    const type = passwordInput.getAttribute('type');
    passwordInput.setAttribute('type', type === 'password' ? 'text' : 'password');
    toggleBtn.textContent = type === 'password' ? 'üôà' : 'üëÅÔ∏è';
    toggleBtn.setAttribute('aria-label', type === 'password' ? 'Ocultar contrase√±a' : 'Mostrar contrase√±a');
  });

  // Calcula la fuerza (score de 0 a 5)
  function calculatePasswordStrength(pw) {
    return Object.values(pwReqs).reduce((score, test) => score + test(pw), 0);
  }

  passwordInput.addEventListener('input', () => {
    const val = passwordInput.value;
    const score = calculatePasswordStrength(val);

    // Actualizar barra de fuerza
    const widthPct = (score / 5) * 100;
    strengthFill.style.width = widthPct + '%';
    strengthFill.className = ''; // limpiar
    if (score <= 2) {
      strengthFill.classList.add('strength-weak');
      strengthText.textContent = ':c';
    } else if (score <= 4) {
      strengthFill.classList.add('strength-medium');
      strengthText.textContent = ':|';
    } else {
      strengthFill.classList.add('strength-strong');
      strengthText.textContent = ':D';
    }

    // Actualizar lista de requisitos
    let anyMissing = false;
    for (const [key, testFn] of Object.entries(pwReqs)) {
      const li = document.querySelector(`[data-i18n="${key}"]`);
      const passed = testFn(val);
      li.classList.remove('fade-in', 'fade-out');
      li.style.display = passed ? 'none' : 'list-item';
      li.textContent = (passed ? '‚úÖ ' : '‚ùå ') + translations[currentLang][key];
      if (!passed) anyMissing = true;
    }

    // Ocultar lista si ya todos se cumplen
    // Mostrar solo si hay texto en input
    if (val.length === 0) {
      reqList.style.display = 'none';
    } else {
      reqList.style.display = anyMissing ? 'block' : 'none';
    }

  });
</script>


  <script src="js/register.js"></script>
</body>
</html>
